<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xBrush Admin Dashboard</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="model-showcase.css">
    <link rel="stylesheet" href="premium-models.css">
    <link rel="stylesheet" href="css/validation.css">
    
    <style>
        body {
            background: #f7fafc;
            min-height: 100vh;
        }
        
        .admin-header {
            background: #2d3748;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .admin-title {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .admin-subtitle {
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* Tab Navigation */
        .admin-nav-tabs {
            background: white;
            border-radius: 8px;
            padding: 5px;
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #718096;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .tab-btn:hover {
            background: #f7fafc;
        }
        
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Stats Cards */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .stat-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 8px;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* Controls Section */
        .admin-controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 200px;
            max-width: 400px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Table Styles */
        .models-table {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f7fafc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            border-bottom: 1px solid #e2e8f0;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .model-thumbnail {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .model-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .model-details h4 {
            margin: 0;
            font-size: 1rem;
            color: #2d3748;
        }
        
        .model-details p {
            margin: 2px 0;
            font-size: 0.85rem;
            color: #718096;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-active {
            background: #c6f6d5;
            color: #276749;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-inactive {
            background: #e2e8f0;
            color: #718096;
        }
        
        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 2px;
            border: none;
        }
        
        .action-btn.approve {
            background: #48bb78;
            color: white;
        }
        
        .action-btn.reject {
            background: #f56565;
            color: white;
        }
        
        .action-btn.view {
            background: #4299e1;
            color: white;
        }
        
        .action-btn.premium {
            background: #667eea;
            color: white;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #f59e0b;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        /* Plan Review Styles */
        .review-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .review-queue {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .review-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .review-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .model-meta {
            display: flex;
            gap: 15px;
        }
        
        .model-avatar {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }
        
        .tier-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .tier-basic {
            background: #e5e7eb;
            color: #4b5563;
        }
        
        .tier-professional {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .tier-enterprise {
            background: #fef3c7;
            color: #92400e;
        }
        
        .tier-celebrity {
            background: #ede9fe;
            color: #6b21a8;
        }
        
        .plan-details {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .detail-value {
            font-weight: 600;
            color: #1f2937;
        }
        
        .review-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-approve {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-approve:hover {
            background: #059669;
        }
        
        .btn-reject {
            background: #ef4444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-reject:hover {
            background: #dc2626;
        }
        
        .btn-request-info {
            background: #f59e0b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-request-info:hover {
            background: #d97706;
        }
        
        /* Navigation buttons */
        .nav-btn {
            display: inline-block;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .nav-btn.btn-primary {
            background: #667eea;
            color: white;
        }
        
        .nav-btn.btn-outline {
            background: transparent;
            color: white;
            border: 1px solid white;
        }
        
        .nav-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        /* Edit Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            padding: 20px 30px;
            background: #667eea;
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .form-section h3 {
            margin: 0 0 20px 0;
            color: #374151;
            font-size: 1.25rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        /* Thumbnail upload styles */
        .thumbnail-section {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        .thumbnail-upload-area {
            flex: 1;
        }
        
        .thumbnail-preview {
            width: 150px;
            height: 150px;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9fafb;
            position: relative;
        }
        
        .thumbnail-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .thumbnail-preview-placeholder {
            text-align: center;
            color: #9ca3af;
            font-size: 0.875rem;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            margin-top: 10px;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        .file-input-label {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: inline-block;
            font-size: 0.875rem;
            transition: background 0.3s ease;
        }
        
        .file-input-label:hover {
            background: #5a67d8;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .checkbox-label input {
            margin-right: 6px;
        }
        
        .modal-footer {
            padding: 20px 30px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            border-radius: 0 0 12px 12px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-save {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-save:hover {
            background: #059669;
        }
        
        .btn-cancel {
            background: #6b7280;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-cancel:hover {
            background: #4b5563;
        }
    </style>
</head>
<body>
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 class="admin-title">xBrush Admin Dashboard</h1>
                    <p class="admin-subtitle">í†µí•© ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <a href="index.html" class="nav-btn btn-outline">â† ë©”ì¸ìœ¼ë¡œ</a>
                    <a href="models.html" class="nav-btn btn-primary">ëª¨ë¸ ëª©ë¡</a>
                </div>
            </div>
        </div>
    </header>

    <div class="admin-container">
        <!-- Tab Navigation -->
        <div class="admin-nav-tabs">
            <button class="tab-btn active" data-tab="dashboard">ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab-btn" data-tab="models">ëª¨ë¸ ê´€ë¦¬</button>
            <button class="tab-btn" data-tab="plan-review">í”Œëœ ê²€í† </button>
            <button class="tab-btn" data-tab="users">ì‚¬ìš©ì ê´€ë¦¬</button>
            <button class="tab-btn" data-tab="analytics">ë¶„ì„</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalModels">0</div>
                    <div class="stat-label">ì „ì²´ ëª¨ë¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeModels">0</div>
                    <div class="stat-label">í™œì„± ëª¨ë¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingModels">0</div>
                    <div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
                    <span class="stat-badge badge-warning">ê²€í†  í•„ìš”</span>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="premiumModels">0</div>
                    <div class="stat-label">í”„ë¦¬ë¯¸ì—„ ëª¨ë¸</div>
                </div>
            </div>

            <div class="review-section">
                <h2>ë¹ ë¥¸ ì‘ì—…</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="switchTab('models')">ëª¨ë¸ ìŠ¹ì¸í•˜ê¸°</button>
                    <button class="btn btn-primary" onclick="switchTab('plan-review')">í”Œëœ ê²€í† í•˜ê¸°</button>
                    <button class="btn btn-primary" onclick="exportData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-primary" onclick="viewAnalytics()">ë¶„ì„ ë³´ê¸°</button>
                </div>
            </div>
        </div>

        <!-- Models Management Tab -->
        <div id="models" class="tab-content">
            <div class="admin-controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ëª¨ë¸ ì´ë¦„, ì´ë©”ì¼ë¡œ ê²€ìƒ‰..." onkeyup="searchModels()">
                </div>
                <div class="admin-actions">
                    <select id="statusFilter" onchange="filterModels()">
                        <option value="all">ëª¨ë“  ìƒíƒœ</option>
                        <option value="pending">ìŠ¹ì¸ ëŒ€ê¸°</option>
                        <option value="active">í™œì„±</option>
                        <option value="inactive">ë¹„í™œì„±</option>
                    </select>
                    <button class="btn btn-primary" onclick="exportModels()">ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <div class="models-table">
                <table>
                    <thead>
                        <tr>
                            <th>ëª¨ë¸ ì •ë³´</th>
                            <th>ìƒíƒœ</th>
                            <th>ì¹´í…Œê³ ë¦¬</th>
                            <th>ë“±ë¡ì¼</th>
                            <th>í‹°ì–´</th>
                            <th>ì‚¬ì „ ê²€í† </th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="modelsTableBody">
                        <!-- Models will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Plan Review Tab -->
        <div id="plan-review" class="tab-content">
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-value" id="pendingPlans">0</div>
                    <div class="stat-label">ê²€í†  ëŒ€ê¸° í”Œëœ</div>
                    <span class="stat-badge badge-warning">ê¸´ê¸‰</span>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="approvedToday">0</div>
                    <div class="stat-label">ì˜¤ëŠ˜ ìŠ¹ì¸ë¨</div>
                    <span class="stat-badge badge-success">ì™„ë£Œ</span>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="rejectedToday">0</div>
                    <div class="stat-label">ì˜¤ëŠ˜ ê±°ì ˆë¨</div>
                    <span class="stat-badge badge-danger">ê±°ì ˆ</span>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgReviewTime">0</div>
                    <div class="stat-label">í‰ê·  ê²€í†  ì‹œê°„</div>
                </div>
            </div>

            <div class="review-section">
                <h2>ë¼ì´ì„ ìŠ¤ í”Œëœ ê²€í†  ëŒ€ê¸°ì—´</h2>
                <div class="review-queue" id="reviewQueue">
                    <!-- Plan review items will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users" class="tab-content">
            <div class="review-section">
                <h2>ì‚¬ìš©ì ê´€ë¦¬</h2>
                <p>ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="review-section">
                <h2>ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h2>
                <p>ë¶„ì„ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <!-- Edit Model Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ëª¨ë¸ ì •ë³´ ìˆ˜ì •</h2>
                <button class="close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editModelForm">
                    <input type="hidden" id="editModelId" />
                    
                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h3>ê°œì¸ ì •ë³´</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="editName">ì´ë¦„ *</label>
                                <input type="text" class="form-control" id="editName" required>
                            </div>
                            <div class="form-group">
                                <label for="editEmail">ì´ë©”ì¼ *</label>
                                <input type="email" class="form-control" id="editEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="editPhone">ì „í™”ë²ˆí˜¸</label>
                                <input type="tel" class="form-control" id="editPhone">
                            </div>
                            <div class="form-group">
                                <label for="editStatus">ìƒíƒœ</label>
                                <select class="form-control" id="editStatus">
                                    <option value="pending">ìŠ¹ì¸ ëŒ€ê¸°</option>
                                    <option value="active">í™œì„±</option>
                                    <option value="inactive">ë¹„í™œì„±</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label for="editIntro">ì†Œê°œ</label>
                                <textarea class="form-control" id="editIntro" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tier and Categories Section -->
                    <div class="form-section">
                        <h3>í‹°ì–´ ë° ì¹´í…Œê³ ë¦¬</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="editTier">í‹°ì–´</label>
                                <select class="form-control" id="editTier">
                                    <option value="basic">ë² ì´ì§</option>
                                    <option value="professional">í”„ë¡œí˜ì…”ë„</option>
                                    <option value="premium">í”„ë¦¬ë¯¸ì—„</option>
                                    <option value="vip">VIP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editSortPriority">ì •ë ¬ ìš°ì„ ìˆœìœ„</label>
                                <input type="number" class="form-control" id="editSortPriority" value="0" min="0">
                            </div>
                            <div class="form-group full-width">
                                <label>ì¹´í…Œê³ ë¦¬</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="categories" value="fashion"> íŒ¨ì…˜
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="categories" value="beauty"> ë·°í‹°
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="categories" value="lifestyle"> ë¼ì´í”„ìŠ¤íƒ€ì¼
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="categories" value="food"> í‘¸ë“œ
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="categories" value="tech"> í…Œí¬
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pricing Section -->
                    <div class="form-section">
                        <h3>ê°€ê²© ì •ë³´</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="editBasePrice">ê¸°ë³¸ ê°€ê²©</label>
                                <input type="number" class="form-control" id="editBasePrice" min="0">
                            </div>
                            <div class="form-group">
                                <label for="editLowestPrice">ìµœì € ê°€ê²©</label>
                                <input type="number" class="form-control" id="editLowestPrice" min="0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profile Section -->
                    <div class="form-section">
                        <h3>í”„ë¡œí•„ ì •ë³´</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="editDisplayName">í‘œì‹œ ì´ë¦„</label>
                                <input type="text" class="form-control" id="editDisplayName">
                            </div>
                            <div class="form-group">
                                <label for="editTagline">íƒœê·¸ë¼ì¸</label>
                                <input type="text" class="form-control" id="editTagline">
                            </div>
                            <div class="form-group full-width">
                                <label for="editProfileImage">í”„ë¡œí•„ ì´ë¯¸ì§€ URL</label>
                                <input type="url" class="form-control" id="editProfileImage">
                            </div>
                            <div class="form-group full-width">
                                <label>ì¸ë„¤ì¼</label>
                                <div class="thumbnail-section">
                                    <div class="thumbnail-upload-area">
                                        <input type="url" class="form-control" id="editThumbnailUrl" placeholder="ì¸ë„¤ì¼ URL ì…ë ¥">
                                        <div class="file-input-wrapper">
                                            <input type="file" id="thumbnailFile" accept="image/*" onchange="handleThumbnailUpload(event)">
                                            <label for="thumbnailFile" class="file-input-label">ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                                        </div>
                                    </div>
                                    <div class="thumbnail-preview" id="thumbnailPreview">
                                        <div class="thumbnail-preview-placeholder">
                                            <div>ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°</div>
                                            <div style="font-size: 2rem; margin-top: 8px;">ğŸ“·</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistics Section -->
                    <div class="form-section">
                        <h3>í†µê³„ ë° í‰ê°€</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="editRating">í‰ì </label>
                                <input type="number" class="form-control" id="editRating" min="0" max="5" step="0.1">
                            </div>
                            <div class="form-group">
                                <label for="editTotalLicenses">ì´ ë¼ì´ì„ ìŠ¤</label>
                                <input type="number" class="form-control" id="editTotalLicenses" min="0">
                            </div>
                            <div class="form-group">
                                <label for="editResponseTime">ì‘ë‹µ ì‹œê°„</label>
                                <input type="text" class="form-control" id="editResponseTime" placeholder="ì˜ˆ: 2ì‹œê°„, ì¦‰ì‹œ ê°€ëŠ¥">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pre-review Rights Section -->
                    <div class="form-section">
                        <h3>ì‚¬ì „ ê²€í†  ê¶Œë¦¬</h3>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label class="checkbox-label" style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="editPreReviewRights" style="width: 20px; height: 20px;">
                                    <span>ì‚¬ì „ ê²€í†  ê¶Œë¦¬ í™œì„±í™”</span>
                                </label>
                                <p class="help-text" style="margin-top: 10px; color: #666; font-size: 14px;">í™œì„±í™”í•˜ë©´ ëª¨ë“  ìƒì„± ê²°ê³¼ë¬¼ì— ëŒ€í•´ ëª¨ë¸ì˜ ì‚¬ì „ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeEditModal()">ì·¨ì†Œ</button>
                <button type="button" class="btn-save" onclick="saveModelChanges()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/config.js"></script>
    <script src="js/app-namespace.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-model-storage.js"></script>
    <script src="js/model-storage-adapter.js"></script>
    <script src="js/image-storage.js"></script>
    <script src="utils.js"></script>

    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Activate corresponding button
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Load data for the tab
            if (tabName === 'models') {
                loadModels();
            } else if (tabName === 'plan-review') {
                loadPlanReviews();
            } else if (tabName === 'dashboard') {
                loadDashboardStats();
            }
        }

        // Add event listeners to tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        // Load dashboard stats
        async function loadDashboardStats() {
            try {
                const models = await window.modelStorageAdapter.getAllModels();
                const activeModels = models.filter(m => m.status === 'active');
                const pendingModels = models.filter(m => m.status === 'pending');
                const premiumModels = models.filter(m => m.tier === 'premium' || m.tier === 'vip');
                
                document.getElementById('totalModels').textContent = models.length;
                document.getElementById('activeModels').textContent = activeModels.length;
                document.getElementById('pendingModels').textContent = pendingModels.length;
                document.getElementById('premiumModels').textContent = premiumModels.length;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load models for management
        async function loadModels() {
            const tbody = document.getElementById('modelsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">ë¡œë”© ì¤‘...</td></tr>';
            
            try {
                // Ensure adapter is initialized
                if (window.modelStorageAdapter?.ensureInitialized) {
                    await window.modelStorageAdapter.ensureInitialized();
                }
                
                const models = await window.modelStorageAdapter.getAllModels();
                displayModels(models);
            } catch (error) {
                console.error('Error loading models:', error);
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: red;">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</td></tr>';
                showToast('ëª¨ë¸ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // Display models in table
        function displayModels(models) {
            const tbody = document.getElementById('modelsTableBody');
            
            if (models.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">ë“±ë¡ëœ ëª¨ë¸ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            tbody.innerHTML = models.map(model => {
                // Extract data from various possible locations
                const name = model.personalInfo?.name || model.profile?.displayName || model.displayName || model.name || 'ì´ë¦„ ì—†ìŒ';
                const email = model.personalInfo?.email || model.email || 'ì´ë©”ì¼ ì—†ìŒ';
                const thumbnailUrl = model.thumbnailUrl || model.personalInfo?.thumbnailUrl || model.portfolio?.thumbnailUrl || model.profileImage || '/images/default-avatar.png';
                const status = model.status || 'pending';
                const categories = model.personalInfo?.categories || model.categories || [];
                const registrationDate = model.registrationDate || model.createdAt || new Date().toISOString();
                const tier = model.tier || 'basic';
                
                return `
                    <tr>
                        <td>
                            <div class="model-info">
                                <img src="${thumbnailUrl}" 
                                     alt="${name}" class="model-thumbnail"
                                     onerror="this.src='/images/default-avatar.png'">
                                <div class="model-details">
                                    <h4>${name}</h4>
                                    <p>${email}</p>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-${status}">
                                ${status === 'active' ? 'í™œì„±' : status === 'pending' ? 'ëŒ€ê¸°' : 'ë¹„í™œì„±'}
                            </span>
                        </td>
                        <td>${categories.join(', ') || '-'}</td>
                        <td>${formatDate(registrationDate)}</td>
                        <td>
                            <span class="tier-badge tier-${tier}">
                                ${getTierName(tier)}
                            </span>
                        </td>
                        <td style="text-align: center;">
                            <label class="toggle-switch" title="${model.contract?.secondConfirm ? 'ì‚¬ì „ ê²€í†  í™œì„±í™”ë¨' : 'ì‚¬ì „ ê²€í†  ë¹„í™œì„±í™”ë¨'}">
                                <input type="checkbox" 
                                       ${model.contract?.secondConfirm ? 'checked' : ''} 
                                       onchange="togglePreReview('${model.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </td>
                        <td>
                            <button class="action-btn view" onclick="editModel('${model.id}')">í¸ì§‘</button>
                            ${status === 'pending' ? 
                                `<button class="action-btn approve" onclick="approveModel('${model.id}')">ìŠ¹ì¸</button>
                                 <button class="action-btn reject" onclick="rejectModel('${model.id}')">ê±°ì ˆ</button>` :
                                `<button class="action-btn premium" onclick="togglePremium('${model.id}')">í”„ë¦¬ë¯¸ì—„</button>
                                 <button class="action-btn" onclick="deleteModel('${model.id}')" style="background: #ef4444;">ì‚­ì œ</button>`
                            }
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load plan reviews
        async function loadPlanReviews() {
            try {
                // This would normally fetch from a plans collection
                const models = await window.modelStorageAdapter.getAllModels();
                const pendingPlans = models.filter(m => m.planStatus === 'pending' || m.status === 'pending');
                
                document.getElementById('pendingPlans').textContent = pendingPlans.length;
                document.getElementById('approvedToday').textContent = '0'; // Would calculate from real data
                document.getElementById('rejectedToday').textContent = '0';
                document.getElementById('avgReviewTime').textContent = '2.5ì‹œê°„';
                
                displayPlanReviews(pendingPlans);
            } catch (error) {
                console.error('Error loading plan reviews:', error);
            }
        }

        // Display plan reviews
        function displayPlanReviews(plans) {
            const reviewQueue = document.getElementById('reviewQueue');
            
            if (plans.length === 0) {
                reviewQueue.innerHTML = '<p style="text-align: center; padding: 40px; color: #718096;">ê²€í†  ëŒ€ê¸° ì¤‘ì¸ í”Œëœì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            reviewQueue.innerHTML = plans.map(plan => `
                <div class="review-item">
                    <div class="review-header">
                        <div class="model-meta">
                            <img src="${plan.thumbnailUrl || plan.profileImage || '/images/default-avatar.png'}" 
                                 alt="${plan.name}" class="model-avatar">
                            <div>
                                <h3>${plan.name || plan.personalInfo?.name || 'ì´ë¦„ ì—†ìŒ'}</h3>
                                <p style="color: #6b7280; margin-top: 4px;">
                                    ${plan.email || plan.personalInfo?.email || 'ì´ë©”ì¼ ì—†ìŒ'}
                                </p>
                            </div>
                        </div>
                        <span class="tier-badge tier-${plan.requestedTier || plan.tier || 'professional'}">
                            ${getTierName(plan.requestedTier || plan.tier || 'professional')}
                        </span>
                    </div>
                    
                    <div class="plan-details">
                        <div class="detail-row">
                            <span class="detail-label">ì‹ ì²­ í”Œëœ</span>
                            <span class="detail-value">${getTierName(plan.requestedTier || plan.tier || 'professional')}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ì›” ì˜ˆìƒ ìˆ˜ìµ</span>
                            <span class="detail-value">â‚©${((plan.pricing?.basePrice || 100000) * 10).toLocaleString()}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">í¬íŠ¸í´ë¦¬ì˜¤</span>
                            <span class="detail-value">${plan.portfolio?.images?.length || 0}ê°œ ì´ë¯¸ì§€</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ì‹ ì²­ì¼</span>
                            <span class="detail-value">${formatDate(plan.createdAt || plan.registrationDate)}</span>
                        </div>
                    </div>
                    
                    <div class="review-actions">
                        <button class="btn-approve" onclick="approvePlan('${plan.id}')">
                            âœ“ ìŠ¹ì¸
                        </button>
                        <button class="btn-reject" onclick="rejectPlan('${plan.id}')">
                            âœ— ê±°ì ˆ
                        </button>
                        <button class="btn-request-info" onclick="requestMoreInfo('${plan.id}')">
                            ğŸ“‹ ì¶”ê°€ ì •ë³´ ìš”ì²­
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Model management functions
        async function togglePremium(modelId) {
            try {
                const model = await window.modelStorageAdapter.getModel(modelId);
                const currentTier = model.tier || 'basic';
                const newTier = currentTier === 'premium' || currentTier === 'vip' ? 'basic' : 'premium';
                
                if (confirm(`${model.personalInfo?.name || model.displayName}ì˜ í‹°ì–´ë¥¼ ${getTierName(newTier)}ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    await window.modelStorageAdapter.updateModel(modelId, { 
                        tier: newTier,
                        updatedAt: new Date().toISOString()
                    });
                    showToast('í‹°ì–´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadModels();
                }
            } catch (error) {
                console.error('Error toggling premium:', error);
                showToast('í‹°ì–´ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        async function approveModel(modelId) {
            try {
                await window.modelStorageAdapter.updateModel(modelId, { status: 'active' });
                showToast('ëª¨ë¸ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadModels();
            } catch (error) {
                console.error('Error approving model:', error);
                showToast('ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        async function rejectModel(modelId) {
            if (!confirm('ì •ë§ ì´ ëª¨ë¸ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await window.modelStorageAdapter.updateModel(modelId, { status: 'rejected' });
                showToast('ëª¨ë¸ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadModels();
            } catch (error) {
                console.error('Error rejecting model:', error);
                showToast('ê±°ì ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // Plan review functions
        async function approvePlan(planId) {
            try {
                await window.modelStorageAdapter.updateModel(planId, { 
                    planStatus: 'approved',
                    status: 'active',
                    approvedAt: new Date().toISOString()
                });
                showToast('í”Œëœì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadPlanReviews();
            } catch (error) {
                console.error('Error approving plan:', error);
                showToast('í”Œëœ ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        async function rejectPlan(planId) {
            const reason = prompt('ê±°ì ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            if (!reason) return;
            
            try {
                await window.modelStorageAdapter.updateModel(planId, { 
                    planStatus: 'rejected',
                    rejectionReason: reason,
                    rejectedAt: new Date().toISOString()
                });
                showToast('í”Œëœì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadPlanReviews();
            } catch (error) {
                console.error('Error rejecting plan:', error);
                showToast('í”Œëœ ê±°ì ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function requestMoreInfo(planId) {
            const info = prompt('ìš”ì²­í•  ì¶”ê°€ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            if (!info) return;
            
            showToast('ì¶”ê°€ ì •ë³´ ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // Helper functions
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR');
        }

        function getTierName(tier) {
            const tierNames = {
                basic: 'ë² ì´ì§',
                professional: 'í”„ë¡œí˜ì…”ë„',
                premium: 'í”„ë¦¬ë¯¸ì—„',
                enterprise: 'ì—”í„°í”„ë¼ì´ì¦ˆ',
                celebrity: 'ì…€ëŸ¬ë¸Œë¦¬í‹°',
                vip: 'VIP'
            };
            return tierNames[tier] || 'ë² ì´ì§';
        }
        
        function getStatusLabel(status) {
            const labels = {
                pending: 'ìŠ¹ì¸ ëŒ€ê¸°',
                active: 'í™œì„±',
                inactive: 'ë¹„í™œì„±',
                rejected: 'ê±°ì ˆë¨'
            };
            return labels[status] || status;
        }
        
        function getTierLabel(tier) {
            return getTierName(tier);
        }

        // Edit model functions
        let currentEditingModel = null;
        
        async function editModel(modelId) {
            try {
                const models = await window.modelStorageAdapter.getAllModels();
                const model = models.find(m => m.id === modelId);
                
                if (!model) {
                    showToast('ëª¨ë¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                currentEditingModel = model;
                populateEditForm(model);
                document.getElementById('editModal').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading model for edit:', error);
                showToast('ëª¨ë¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        function populateEditForm(model) {
            // Personal Information
            document.getElementById('editModelId').value = model.id;
            document.getElementById('editName').value = model.personalInfo?.name || model.name || '';
            document.getElementById('editEmail').value = model.personalInfo?.email || model.email || '';
            document.getElementById('editPhone').value = model.personalInfo?.phone || model.phone || '';
            document.getElementById('editStatus').value = model.status || 'pending';
            document.getElementById('editIntro').value = model.personalInfo?.intro || model.intro || '';
            
            // Tier and Categories
            document.getElementById('editTier').value = model.tier || 'basic';
            document.getElementById('editSortPriority').value = model.sortPriority || 0;
            
            // Categories
            const categories = model.personalInfo?.categories || model.categories || [];
            document.querySelectorAll('input[name="categories"]').forEach(checkbox => {
                checkbox.checked = categories.includes(checkbox.value);
            });
            
            // Pricing
            document.getElementById('editBasePrice').value = model.pricing?.basePrice || model.basePrice || '';
            document.getElementById('editLowestPrice').value = model.lowestPrice || '';
            
            // Profile
            document.getElementById('editDisplayName').value = model.displayName || model.personalInfo?.name || '';
            document.getElementById('editTagline').value = model.tagline || '';
            document.getElementById('editProfileImage').value = model.profileImage || model.personalInfo?.thumbnailUrl || '';
            
            // Thumbnail
            const thumbnailUrl = model.thumbnailUrl || model.personalInfo?.thumbnailUrl || model.portfolio?.thumbnailUrl || '';
            document.getElementById('editThumbnailUrl').value = thumbnailUrl;
            updateThumbnailPreview(thumbnailUrl);
            currentThumbnailFile = null; // Reset file upload
            
            // Statistics
            document.getElementById('editRating').value = model.rating || 0;
            document.getElementById('editTotalLicenses').value = model.totalLicenses || 0;
            document.getElementById('editResponseTime').value = model.responseTime || '';
            
            // Pre-review rights
            document.getElementById('editPreReviewRights').checked = model.contract?.secondConfirm || false;
        }
        
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditingModel = null;
        }
        
        async function saveModelChanges() {
            if (!currentEditingModel) return;
            
            try {
                showToast('ì €ì¥ ì¤‘...', 'info');
                
                // Handle thumbnail upload if file is selected
                let thumbnailUrl = document.getElementById('editThumbnailUrl').value;
                
                if (currentThumbnailFile) {
                    try {
                        // Upload to Firebase Storage
                        const storage = window.firebaseStorage;
                        const storageRef = storage.ref();
                        const fileName = `models/thumbnails/${currentEditingModel.id}_${Date.now()}.jpg`;
                        const fileRef = storageRef.child(fileName);
                        
                        const snapshot = await fileRef.put(currentThumbnailFile);
                        thumbnailUrl = await snapshot.ref.getDownloadURL();
                        
                        console.log('Thumbnail uploaded:', thumbnailUrl);
                    } catch (uploadError) {
                        console.error('Thumbnail upload failed:', uploadError);
                        showToast('ì¸ë„¤ì¼ ì—…ë¡œë“œ ì‹¤íŒ¨. URLì„ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                        return;
                    }
                }
                
                // Gather all form data
                const categories = [];
                document.querySelectorAll('input[name="categories"]:checked').forEach(checkbox => {
                    categories.push(checkbox.value);
                });
                
                const updatedData = {
                    personalInfo: {
                        name: document.getElementById('editName').value,
                        email: document.getElementById('editEmail').value,
                        phone: document.getElementById('editPhone').value,
                        intro: document.getElementById('editIntro').value,
                        categories: categories,
                        thumbnailUrl: thumbnailUrl || document.getElementById('editProfileImage').value
                    },
                    status: document.getElementById('editStatus').value,
                    tier: document.getElementById('editTier').value,
                    sortPriority: parseInt(document.getElementById('editSortPriority').value) || 0,
                    categories: categories,
                    pricing: {
                        basePrice: parseInt(document.getElementById('editBasePrice').value) || 0,
                        packages: currentEditingModel.pricing?.packages || []
                    },
                    basePrice: parseInt(document.getElementById('editBasePrice').value) || 0,
                    lowestPrice: parseInt(document.getElementById('editLowestPrice').value) || 0,
                    displayName: document.getElementById('editDisplayName').value,
                    tagline: document.getElementById('editTagline').value,
                    profileImage: document.getElementById('editProfileImage').value,
                    thumbnailUrl: thumbnailUrl,
                    rating: parseFloat(document.getElementById('editRating').value) || 0,
                    totalLicenses: parseInt(document.getElementById('editTotalLicenses').value) || 0,
                    responseTime: document.getElementById('editResponseTime').value,
                    contract: {
                        ...(currentEditingModel.contract || {}),
                        secondConfirm: document.getElementById('editPreReviewRights').checked
                    },
                    updatedAt: new Date().toISOString()
                };
                
                // Update in Firebase
                await window.modelStorageAdapter.updateModel(currentEditingModel.id, updatedData);
                
                showToast('ëª¨ë¸ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                closeEditModal();
                loadModels(); // Reload the models list
                
            } catch (error) {
                console.error('Error saving model changes:', error);
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }
        
        async function deleteModel(modelId) {
            if (!confirm('ì •ë§ ì´ ëª¨ë¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            
            try {
                await window.modelStorageAdapter.deleteModel(modelId);
                showToast('ëª¨ë¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadModels();
            } catch (error) {
                console.error('Error deleting model:', error);
                showToast('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // Toggle pre-review rights
        async function togglePreReview(modelId, enabled) {
            try {
                // Get the current model data
                const models = await window.modelStorageAdapter.getAllModels();
                const model = models.find(m => m.id === modelId);
                
                if (!model) {
                    showToast('ëª¨ë¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                // Update contract object with new pre-review status
                const updatedContract = {
                    ...(model.contract || {}),
                    secondConfirm: enabled
                };
                
                await window.modelStorageAdapter.updateModel(modelId, { 
                    contract: updatedContract 
                });
                
                showToast(
                    enabled ? 'ì‚¬ì „ ê²€í†  ê¶Œë¦¬ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì‚¬ì „ ê²€í†  ê¶Œë¦¬ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 
                    'success'
                );
                
                // Refresh the table
                loadModels();
            } catch (error) {
                console.error('Error toggling pre-review:', error);
                showToast('ì‚¬ì „ ê²€í†  ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                // Reload to reset the toggle
                loadModels();
            }
        }
        
        function viewModel(modelId) {
            window.open(`model-detail.html?id=${modelId}`, '_blank');
        }

        function togglePremium(modelId) {
            if (typeof togglePremiumStatus === 'function') {
                togglePremiumStatus(modelId);
            } else {
                alert('í”„ë¦¬ë¯¸ì—„ ê´€ë¦¬ ê¸°ëŠ¥ì„ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤...');
            }
        }

        // Search functionality
        function searchModels() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#modelsTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Filter functionality
        function filterModels() {
            const filterValue = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('#modelsTableBody tr');
            
            rows.forEach(row => {
                if (filterValue === 'all') {
                    row.style.display = '';
                } else {
                    const statusBadge = row.querySelector('.status-badge');
                    const status = statusBadge ? statusBadge.classList[1].replace('status-', '') : '';
                    row.style.display = status === filterValue ? '' : 'none';
                }
            });
        }

        // Export functions
        function exportModels() {
            showToast('ëª¨ë¸ ë°ì´í„°ë¥¼ ë‚´ë³´ë‚´ëŠ” ì¤‘...', 'info');
            // Implementation would export to CSV/Excel
        }

        function exportData() {
            showToast('ì „ì²´ ë°ì´í„°ë¥¼ ë‚´ë³´ë‚´ëŠ” ì¤‘...', 'info');
            // Implementation would export all data
        }

        function viewAnalytics() {
            switchTab('analytics');
        }

        // Initialize on load
        window.addEventListener('firebaseReady', function() {
            loadDashboardStats();
        });

        // Also check if Firebase is already ready
        if (window.firebaseDB) {
            loadDashboardStats();
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeEditModal();
            }
        }
        
        // Thumbnail handling functions
        let currentThumbnailFile = null;
        
        async function handleThumbnailUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showToast('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            currentThumbnailFile = file;
            
            // Preview the image
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('thumbnailPreview');
                preview.innerHTML = `<img src="${e.target.result}" alt="ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°">`;
            };
            reader.readAsDataURL(file);
        }
        
        function updateThumbnailPreview(url) {
            const preview = document.getElementById('thumbnailPreview');
            if (url) {
                preview.innerHTML = `<img src="${url}" alt="ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\\'thumbnail-preview-placeholder\\'><div>ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨</div><div style=\\'font-size: 2rem; margin-top: 8px;\\'>âŒ</div></div>';">`;
            } else {
                preview.innerHTML = `
                    <div class="thumbnail-preview-placeholder">
                        <div>ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°</div>
                        <div style="font-size: 2rem; margin-top: 8px;">ğŸ“·</div>
                    </div>
                `;
            }
        }
        
        // Improved initialization
        async function initializeAdmin() {
            const maxRetries = 20;
            let retries = 0;
            
            const checkServices = () => {
                return window.firebaseDB && 
                       window.modelStorageAdapter && 
                       window.firebaseStorage;
            };
            
            while (retries < maxRetries) {
                if (checkServices()) {
                    console.log('All services ready');
                    
                    // Ensure adapter is initialized
                    if (window.modelStorageAdapter.ensureInitialized) {
                        try {
                            await window.modelStorageAdapter.ensureInitialized();
                        } catch (error) {
                            console.error('Error initializing adapter:', error);
                        }
                    }
                    
                    // Setup URL input listener
                    const urlInput = document.getElementById('editThumbnailUrl');
                    if (urlInput) {
                        urlInput.addEventListener('input', function(e) {
                            if (e.target.value) {
                                updateThumbnailPreview(e.target.value);
                                currentThumbnailFile = null; // Clear file if URL is entered
                            }
                        });
                    }
                    
                    loadDashboardStats();
                    return;
                }
                await new Promise(resolve => setTimeout(resolve, 500));
                retries++;
            }
            
            showToast('Firebase ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        }
        
        // Call initialization on page load
        window.addEventListener('DOMContentLoaded', initializeAdmin);
    </script>
</body>
</html>